# Go手写一个BT下载器
B站上面大神的项目。

# BitTorrent下载的原理
虽然我不清楚细节，不过我想就是 P2P的核心概念；

以前（或者说很久以前）是**中心化**下载，很明显这种方式，对于客户端来说，服务器的带宽就决定了cli的顶级速度
所以当用户（客户端的数量）越来越多的时候，体验就会显著降低。

P2P就是点对点传输，是一种（应该是）分布式的思想。

细节不知道说清楚了没有，反正BT下载器的核心思想就是：
把**文件分成一个个的片（piece）**，有哪个节点（peer）想要下载，就从其他所有的结点里面去下载数据就行；
是**人人为我，我为人人**的体现。我个人认为这就是图这种DS的体现；

要实现基本的BT下载，有两个要解决的问题：
1. （你要下载的东西在别人的电脑里面，你要怎么知道你要从谁的电脑里面去下？） How to find peers?
1. 第二，你要怎么下呢？

第一个问题可以通过**中心的思想**，之前中心的思想是应用在下载上面，下载的带宽要求大；但是现在就相当于只要提供一个信息：**谁的电脑里面要你想要的东西**，这样带宽压力几乎没有；

第二个问题的话： 如歌从多个peers里面下载一个完整的文件呢？
这里的话用的是一种比较原始的方法： 把一个文件分割成多个片（piece），然后加上各种覆盖的信息，下载的时候根据各种选择信息去下载就可以了。


那么在**代码层面**的实现：
bt下载有一个文件叫做种子文件：TorrentFile,
它实际上就是一个info的文件，包含了各种下载文件需要的**信息**，这个文件不大，只有几kb而已；
里面的信息大概是这个样子：
![Img](./res/drawable/TorrentFile格式.png)

那么很容易就想到： 一个torrent文件实际上是可以用文本格式打开的，里面的内容就是协议里面的那些；

## Bencode 协议
这个协议的内容很简单：他只能支持传输**四种**数据类型
![Img](./res/drawable/Bencode协议支持的四种数据类型.png)

顺便一提这种协议的格式**有点像Python或者toml那种，对空格和缩进的要求比较严格之类的**
反正不要去寄；

Bencode这个协议的优点：
- 相比于json类型简单，呃我不是特别能理解
- 这个协议特别适合网络传输：从第一个字符就可以知道对应data的类型，然后决定对应的逻辑；

## 整个程序的编码的逻辑
大概就按照这个截图的来：
![Img](./res/drawable/BT下载器的编码计划.png)

# 实际编写Bencode库
Bencode库实际上就是实现 bencode协议的**序列化和反序列化**；

首先是四种bencode支持的数据类型：str、int、list和dict

首先在程序里面把所有的bencode抽象成在代码中：

贴一下四种数据类型的处理方式的截图：
